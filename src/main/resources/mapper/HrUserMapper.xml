<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nado.rlzy.db.mapper.HrUserMapper">
    <resultMap id="BaseResultMap" type="com.nado.rlzy.db.pojo.HrUser">
        <id column="Id" property="id" jdbcType="INTEGER"/>
        <result column="UserName" property="userName" jdbcType="VARCHAR"/>
        <result column="RoleId" property="roleId" jdbcType="INTEGER"/>
        <result column="Password" property="password" jdbcType="VARCHAR"/>
        <result column="HeadImage" property="headImage" jdbcType="VARCHAR"/>
        <result column="PostIdStr" property="postIdStr" jdbcType="VARCHAR"/>
        <result column="Mobile" property="mobile" jdbcType="VARCHAR"/>
        <result column="IdCard" property="idCard" jdbcType="VARCHAR"/>
        <result column="RegisterTime" property="registerTime" jdbcType="TIMESTAMP"/>
        <result column="RecommendNoUpper" property="recommendNoUpper" jdbcType="INTEGER"/>
        <result column="RecommendNoLower" property="recommendNoLower" jdbcType="INTEGER"/>
        <result column="RecommendInfo" property="recommendInfo" jdbcType="VARCHAR"/>
        <result column="RecommenderId" property="recommenderId" jdbcType="INTEGER"/>
        <result column="LoginIp" property="loginIp" jdbcType="VARCHAR"/>
        <result column="LoginTime" property="loginTime" jdbcType="TIMESTAMP"/>
        <result column="DeleteFlag" property="deleteFlag" jdbcType="INTEGER"/>
        <result column="type" property="type" jdbcType="INTEGER"/>
        <result column="isPublic" property="publicIs" jdbcType="INTEGER"/>
        <collection property="signUp" resultMap="resultMap" ofType="com.nado.rlzy.db.pojo.HrSignUp"/>


    </resultMap>
    <resultMap id="resultMap" type="com.nado.rlzy.db.pojo.HrSignUp">
        <result column="user_name" property="userName" jdbcType="VARCHAR"/>
        <result column="job_status" property="jobStatus" jdbcType="INTEGER"/>
        <result column="user_id" property="userId" jdbcType="INTEGER"/>
        <result column="no_report_reason" property="noReportReason" jdbcType="INTEGER"/>
    </resultMap>

    <insert id="save" parameterType="com.nado.rlzy.db.pojo.HrUser" useGeneratedKeys="true" keyProperty="id">
        insert into hr_user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                Id,
            </if>
            <if test="userName != null">
                UserName,
            </if>
            <if test="roleId != null">
                RoleId,
            </if>
            <if test="password != null">
                Password,
            </if>
            <if test="headImage != null">
                HeadImage,
            </if>
            <if test="postIdStr != null">
                PostIdStr,
            </if>
            <if test="mobile != null">
                Mobile,
            </if>
            <if test="idCard != null">
                IdCard,
            </if>
            <if test="registerTime != null">
                RegisterTime,
            </if>
            <if test="recommendNoUpper != null">
                RecommendNoUpper,
            </if>
            <if test="recommendNoLower != null">
                RecommendNoLower,
            </if>
            <if test="recommendInfo != null">
                RecommendInfo,
            </if>
            <if test="recommenderId != null">
                RecommenderId,
            </if>
            <if test="loginIp != null">
                LoginIp,
            </if>
            <if test="loginTime != null">
                LoginTime,
            </if>
            <if test="deleteFlag != null">
                DeleteFlag,
            </if>
            <if test="type != null">
                type,
            </if>
            <if test="publicIs != null">
                isPublic,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=INTEGER},
            </if>
            <if test="username != null">
                #{userName,jdbcType=VARCHAR},
            </if>
            <if test="roleId != null">
                #{roleId,jdbcType=INTEGER},
            </if>
            <if test="password != null">
                #{password,jdbcType=VARCHAR},
            </if>
            <if test="headImage != null">
                #{headImage,jdbcType=VARCHAR},
            </if>
            <if test="postIdStr != null">
                #{postIdStr,jdbcType=VARCHAR},
            </if>
            <if test="mobile != null">
                #{mobile,jdbcType=VARCHAR},
            </if>
            <if test="idCard != null">
                #{idCard,jdbcType=VARCHAR},
            </if>
            <if test="registerTime != null">
                #{registerTime,jdbcType=TIMESTAMP},
            </if>
            <if test="recommendNoUpper != null">
                #{recommendNoUpper,jdbcType=VARCHAR},
            </if>
            <if test="recommendNoLower != null">
                #{recommendNoLower,jdbcType=VARCHAR},
            </if>
            <if test="recommendInfo != null">
                #{recommendInfo,jdbcType=VARCHAR},
            </if>
            <if test="recommenderId != null">
                #{recommenderId,jdbcType=INTEGER},
            </if>
            <if test="loginIp != null">
                #{loginIp,jdbcType=VARCHAR},
            </if>
            <if test="loginTime != null">
                #{loginTime,jdbcType=TIMESTAMP},
            </if>
            <if test="deleteFlag != null">
                #{deleteFlag, jdbcType=BIT},
            </if>
            <if test="type != null">
                #{type,jdbcType=INTEGER},
            </if>
            <if test="publicIs != null">
                #{publicIs, jdbcType=INTEGER},
            </if>
        </trim>
    </insert>

    <update id="editPersonData" parameterType="com.nado.rlzy.db.pojo.HrUser">
        update hr_user
        <set>
            <if test="userName != null and '' != userName">
                UserName = #{userName},
            </if>
            <if test="roleId != null">
                RoleId = #{roleId,jdbcType=INTEGER},
            </if>
            <if test="password != null and '' != password">
                Password = #{password,jdbcType=VARCHAR},
            </if>
            <if test="headImage != null and '' != headImage">
                HeadImage = #{headImage,jdbcType=VARCHAR},
            </if>
            <if test="postIdStr != null and '' != postIdStr">
                PostIdStr = #{postIdStr,jdbcType=VARCHAR},
            </if>
            <if test="mobile != null and '' != mobile">
                Mobile = #{mobile,jdbcType=VARCHAR},
            </if>
            <if test="idCard != null and '' != idCard">
                IdCard = #{idCard,jdbcType=VARCHAR},
            </if>
            <if test="registerTime != null">
                RegisterTime = #{registerTime,jdbcType=TIMESTAMP},
            </if>
            <if test="recommendNoUpper != null">
                RecommendNoUpper = #{recommendNoUpper,jdbcType=INTEGER},
            </if>
            <if test="recommendNoLower != null">
                RecommendNoLower = #{recommendNoLower,jdbcType=VARCHAR},
            </if>
            <if test="recommendInfo != null and '' != recommendInfo">
                RecommendInfo = #{recommendInfo,jdbcType=VARCHAR},
            </if>
            <if test="recommenderId != null">
                RecommenderId = #{recommenderId,jdbcType=INTEGER},
            </if>
            <if test="loginIp != null and '' != loginIp">
                LoginIp = #{loginIp,jdbcType=VARCHAR},
            </if>
            <if test="loginTime != null">
                LoginTime = #{loginTime,jdbcType=TIMESTAMP},
            </if>
            <if test="deleteFlag != null">
                DeleteFlag = #{deleteFlag,jdbcType=INTEGER},
            </if>
            <if test="type != null">
                type = #{type,jdbcType=INTEGER},
            </if>
            <if test="publicIs != null">
                isPublic = #{publicIs,jdbcType=INTEGER},
            </if>
        </set>
        <where>
            <if test="null != userId">
                id = #{userId}
            </if>
            <if test="null != typeId">
                and type = #{typeId}
            </if>

        </where>
    </update>
    <update id="changePassword">
        update hr_user
        <set>
            Password = #{password}
        </set>
        where Id = #{userId} and DeleteFlag = 0
    </update>
    <update id="switchIdentity">
        update hr_user
        <set>
            <if test="null != type">
                type = #{type}
                <where>
                    <if test="null != userId">
                        Id = #{userId}
                    </if>
                </where>
            </if>
        </set>

    </update>

    <select id="getUserByMobile" resultType="com.nado.rlzy.db.pojo.HrUser" parameterType="map">
        select id,
        userName as userName,
        headImage as headImage,
        Password as password,
        postIdStr as postIdStr,
        mobile as mobile,
        idCard as idCard,
        type as type,
        RecommendNoUpper as recommendNoUpper,
        RecommendNoLower as recommendNoLower,
        RecommendInfo as recommendInfo
        from HR_User
        <where>
            <if test="null != phone and '' != phone">
                mobile = #{mobile}
            </if>
        </where>


    </select>


    <select id="getUserByMobileAndPwd" resultType="com.nado.rlzy.db.pojo.HrUser">
        select id,
        userName,
        headImage,
        postIdStr,
        Password as password,
        mobile,
        idCard,
        type,
        RecommendNoUpper as recommendNoUpper,
        RecommendNoLower as recommendNoLower,
        RecommendInfo as recInfo
        from HR_User
        where mobile= #{mobile} and password =#{password}
    </select>
    <select id="getPassword" resultType="string">
        select Password from hr_user where Mobile = #{phone}
    </select>
    <select id="queryUserByPhone" resultType="com.nado.rlzy.db.pojo.HrUser">
        select * from hr_user
        <where>
            DeleteFlag = 0
            <if test="null != phone">
                and Mobile = #{phone}
            </if>
        </where>
    </select>
    <select id="selectReferrerInfo" resultMap="BaseResultMap">
        select u.UserName,
        u.RecommendNoUpper,
        u.RecommendNoLower,
        u.PostIdStr,
        u.RecommendInfo,
        si.user_name,
        si.job_status,
        si.user_id,
        si.id as signUpId,
        si.no_report_reason,
        u.Id
        from hr_user u
        left join hr_signup si on si.user_id = u.id and si.delete_flag = 0
        <where>
            <if test="null != userId">
                u.id = #{userId}
            </if>
            <if test="null != typeId">
                and u.type = 2;
            </if>
        </where>
    </select>
    <select id="finrdUserById" resultMap="BaseResultMap">
        select * from hr_user where DeleteFlag = 0
        <if test="null != userId">
            and Id = #{userId}
        </if>

    </select>
</mapper>